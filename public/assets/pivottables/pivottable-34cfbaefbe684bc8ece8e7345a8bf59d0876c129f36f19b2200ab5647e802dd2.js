(function(){(function(t){"object"==typeof exports&&"object"==typeof module?t(require("jquery"),require("c3")):"function"==typeof define&&define.amd?define(["jquery","c3"],t):t(jQuery,c3)})(function(et,nt){var t;return t=function(tt){return null==tt&&(tt={}),function(t,e){var n,r,a,o,i,s,l,u,c,p,h,d,f,g,m,v,y,b,x,A,C,w,S,N,T,F,k,E,j,R,D,q,I,M,K,O,L,U,V,H,B,z,P,_,Q,J,W,G,Z,$,Y,X;if(f={localeStrings:{vs:"vs",by:"by"},c3:{}},null==(a=(e=et.extend(!0,f,e)).c3).size&&(a.size={}),null==(o=e.c3.size).width&&(o.width=window.innerWidth/1.4),null==(i=e.c3.size).height&&(i.height=window.innerHeight/1.4-50),null==tt.type&&(tt.type="line"),0===(z=t.getRowKeys()).length&&z.push([]),0===(p=t.getColKeys()).length&&p.push([]),b=function(){var t,e,n;for(n=[],t=0,e=p.length;t<e;t++)v=p[t],n.push(v.join("-"));return n}(),U=0,g=t.aggregatorName,t.valAttrs.length&&(g+="("+t.valAttrs.join(", ")+")"),"scatter"===tt.type)for(_={x:{},y:{},t:{}},G=null!=(q=(r=t.rowAttrs.concat(t.colAttrs))[0])?q:"",y=null!=(I=r[1])?I:"",m=r.slice(2).join("-"),W=G,""!==y&&(W+=" "+e.localeStrings.vs+" "+y),""!==m&&(W+=" "+e.localeStrings.by+" "+m),x=0,S=z.length;x<S;x++)for(B=z[x],A=0,N=p.length;A<N;A++)c=p[A],null!=(n=t.getAggregator(B,c)).value()&&(""===(Q=($=B.concat(c)).slice(2).join("-"))&&(Q="series"),null==(s=_.x)[Q]&&(s[Q]=[]),null==(l=_.y)[Q]&&(l[Q]=[]),null==(u=_.t)[Q]&&(u[Q]=[]),_.y[Q].push(null!=(M=$[0])?M:0),_.x[Q].push(null!=(K=$[1])?K:0),_.t[Q].push(n.format(n.value())));else{for(C=j=0,T=b.length;C<T;C++)j+=(Y=b[C]).length;for(50<j&&(U=45),h=[],w=0,F=z.length;w<F;w++){for(V=[""===(H=(B=z[w]).join("-"))?t.aggregatorName:H],E=0,k=p.length;E<k;E++)c=p[E],Z=parseFloat(t.getAggregator(B,c).value()),isFinite(Z)?Z<1?V.push(Z.toPrecision(3)):V.push(Z.toFixed(3)):V.push(null);h.push(V)}G=t.aggregatorName+(t.valAttrs.length?"("+t.valAttrs.join(", ")+")":""),y=t.colAttrs.join("-"),W=g,""!==y&&(W+=" "+e.localeStrings.vs+" "+y),""!==(m=t.rowAttrs.join("-"))&&(W+=" "+e.localeStrings.by+" "+m)}if((J=et("<p>",{style:"text-align: center; font-weight: bold"})).text(W),D={axis:{y:{label:G},x:{label:y,tick:{rotate:U,multiline:!1}}},data:{type:tt.type},tooltip:{grouped:!1},color:{pattern:["#3366cc","#dc3912","#ff9900","#109618","#990099","#0099c6","#dd4477","#66aa00","#b82e2e","#316395","#994499","#22aa99","#aaaa11","#6633cc","#e67300","#8b0707","#651067","#329262","#5574a6","#3b3eac"]}},et.extend(!0,D,e.c3),"scatter"===tt.type){for(P in X={},R=0,d=[],_.x)R+=1,X[P]=P+"_x",d.push([P+"_x"].concat(_.x[P])),d.push([P].concat(_.y[P]));D.data.xs=X,D.data.columns=d,D.axis.x.tick={fit:!1},1===R&&(D.legend={show:!1}),D.tooltip.format={title:function(){return g},name:function(){return""},value:function(t,e,n,r){return _.t[n][r]}}}else D.axis.x.type="category",D.axis.x.categories=b,D.data.columns=h;return null!=tt.stacked&&(D.data.groups=[function(){var t,e,n;for(n=[],e=0,t=z.length;e<t;e++)Y=z[e],n.push(Y.join("-"));return n}()]),O=et("<div>",{style:"display:none;"}).appendTo(et("body")),L=et("<div>").appendTo(O),D.bindto=L[0],nt.generate(D),L.detach(),O.remove(),et("<div>").append(J,L)}},et.pivotUtilities.c3_renderers={"Line Chart":t(),"Bar Chart":t({type:"bar"}),"Stacked Bar Chart":t({type:"bar",stacked:!0}),"Area Chart":t({type:"area",stacked:!0}),"Scatter Chart":t({type:"scatter"})}})}).call(this),function(){(function(t){"object"==typeof exports&&"object"==typeof module?t(require("jquery"),require("d3")):"function"==typeof define&&define.amd?define(["jquery","d3"],t):t(jQuery,d3)})(function(g,m){return g.pivotUtilities.d3_renderers={Treemap:function(t,e){var u,n,r,a,o,i,s,l,c,p,h,d,f;for(r={localeStrings:{},d3:{width:function(){return g(window).width()/1.4},height:function(){return g(window).height()/1.4}}},e=g.extend(r,e),l=g("<div>").css({width:"100%",height:"100%"}),p={name:"All",children:[]},u=function(t,e,n){var r,a,o,i,s,l;if(0!==e.length){for(null==t.children&&(t.children=[]),l=e.shift(),a=0,o=(s=t.children).length;a<o;a++)if((r=s[a]).name===l)return void u(r,e,n);return u(i={name:l},e,n),t.children.push(i)}t.value=n},o=0,i=(s=t.getRowKeys()).length;o<i;o++)c=s[o],null!=(d=t.getAggregator(c,[]).value())&&u(p,c,d);return n=m.scale.category10(),f=e.d3.width(),a=e.d3.height(),h=m.layout.treemap().size([f,a]).sticky(!0).value(function(t){return t.size}),m.select(l[0]).append("div").style("position","relative").style("width",f+"px").style("height",a+"px").datum(p).selectAll(".node").data(h.padding([15,0,0,0]).value(function(t){return t.value}).nodes).enter().append("div").attr("class","node").style("background",function(t){return null!=t.children?"lightgrey":n(t.name)}).text(function(t){return t.name}).call(function(){this.style("left",function(t){return t.x+"px"}).style("top",function(t){return t.y+"px"}).style("width",function(t){return Math.max(0,t.dx-1)+"px"}).style("height",function(t){return Math.max(0,t.dy-1)+"px"})}),l}}})}.call(this),function(){var Z=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1},g=[].slice,m=function(t,e){return function(){return t.apply(e,arguments)}},$={}.hasOwnProperty;(function(t){"object"==typeof exports&&"object"==typeof module?t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)})(function(_){var Q,r,u,t,n,e,J,W,s,G,a,c,o,i,l,p,h,d,f;return r=function(t,e,n){var r,a,o,i;for(o=(a=(t+="").split("."))[0],i=1<a.length?n+a[1]:"",r=/(\d+)(\d{3})/;r.test(o);)o=o.replace(r,"$1"+e+"$2");return o+i},l=(a=function(n){var t;return t={digitsAfterDecimal:2,scaler:1,thousandsSep:",",decimalSep:".",prefix:"",suffix:"",showZero:!1},n=_.extend(t,n),function(t){var e;return isNaN(t)||!isFinite(t)?"":0!==t||n.showZero?(e=r((n.scaler*t).toFixed(n.digitsAfterDecimal),n.thousandsSep,n.decimalSep),""+n.prefix+e+n.suffix):""}})(),p=a({digitsAfterDecimal:0}),h=a({digitsAfterDecimal:1,scaler:100,suffix:"%"}),t={Count:(f=u={count:function(t){return null==t&&(t=p),function(){return function(){return{count:0,push:function(){return this.count++},value:function(){return this.count},format:t}}}},countUnique:function(e){return null==e&&(e=p),function(t){var n;return n=t[0],function(){return{uniq:[],push:function(t){var e;if(e=t[n],Z.call(this.uniq,e)<0)return this.uniq.push(t[n])},value:function(){return this.uniq.length},format:e,numInputs:null!=n?0:1}}}},listUnique:function(e){return function(t){var n;return n=t[0],function(){return{uniq:[],push:function(t){var e;if(e=t[n],Z.call(this.uniq,e)<0)return this.uniq.push(t[n])},value:function(){return this.uniq.join(e)},format:function(t){return t},numInputs:null!=n?0:1}}}},sum:function(n){return null==n&&(n=l),function(t){var e;return e=t[0],function(){return{sum:0,push:function(t){if(!isNaN(parseFloat(t[e])))return this.sum+=parseFloat(t[e])},value:function(){return this.sum},format:n,numInputs:null!=e?0:1}}}},min:function(e){return null==e&&(e=l),function(t){var r;return r=t[0],function(){return{val:null,push:function(t){var e,n;if(n=parseFloat(t[r]),!isNaN(n))return this.val=Math.min(n,null!=(e=this.val)?e:n)},value:function(){return this.val},format:e,numInputs:null!=r?0:1}}}},max:function(e){return null==e&&(e=l),function(t){var r;return r=t[0],function(){return{val:null,push:function(t){var e,n;if(n=parseFloat(t[r]),!isNaN(n))return this.val=Math.max(n,null!=(e=this.val)?e:n)},value:function(){return this.val},format:e,numInputs:null!=r?0:1}}}},average:function(n){return null==n&&(n=l),function(t){var e;return e=t[0],function(){return{sum:0,len:0,push:function(t){if(!isNaN(parseFloat(t[e])))return this.sum+=parseFloat(t[e]),this.len++},value:function(){return this.sum/this.len},format:n,numInputs:null!=e?0:1}}}},sumOverSum:function(r){return null==r&&(r=l),function(t){var e,n;return n=t[0],e=t[1],function(){return{sumNum:0,sumDenom:0,push:function(t){if(isNaN(parseFloat(t[n]))||(this.sumNum+=parseFloat(t[n])),!isNaN(parseFloat(t[e])))return this.sumDenom+=parseFloat(t[e])},value:function(){return this.sumNum/this.sumDenom},format:r,numInputs:null!=n&&null!=e?0:2}}}},sumOverSumBound80:function(r,a){return null==r&&(r=!0),null==a&&(a=l),function(t){var e,n;return n=t[0],e=t[1],function(){return{sumNum:0,sumDenom:0,push:function(t){if(isNaN(parseFloat(t[n]))||(this.sumNum+=parseFloat(t[n])),!isNaN(parseFloat(t[e])))return this.sumDenom+=parseFloat(t[e])},value:function(){var t;return t=r?1:-1,(.821187207574908/this.sumDenom+this.sumNum/this.sumDenom+1.2815515655446004*t*Math.sqrt(.410593603787454/(this.sumDenom*this.sumDenom)+this.sumNum*(1-this.sumNum/this.sumDenom)/(this.sumDenom*this.sumDenom)))/(1+1.642374415149816/this.sumDenom)},format:a,numInputs:null!=n&&null!=e?0:2}}}},fractionOf:function(a,o,i){return null==o&&(o="total"),null==i&&(i=h),function(){var r;return r=1<=arguments.length?g.call(arguments,0):[],function(t,e,n){return{selector:{total:[[],[]],row:[e,[]],col:[[],n]}[o],inner:a.apply(null,r)(t,e,n),push:function(t){return this.inner.push(t)},format:i,value:function(){return this.inner.value()/t.getAggregator.apply(t,this.selector).inner.value()},numInputs:a.apply(null,r)().numInputs}}}}}).count(p),"Count Unique Values":f.countUnique(p),"List Unique Values":f.listUnique(", "),Sum:f.sum(l),"Integer Sum":f.sum(p),Average:f.average(l),Minimum:f.min(l),Maximum:f.max(l),"Sum over Sum":f.sumOverSum(l),"80% Upper Bound":f.sumOverSumBound80(!0,l),"80% Lower Bound":f.sumOverSumBound80(!1,l),"Sum as Fraction of Total":f.fractionOf(f.sum(),"total",h),"Sum as Fraction of Rows":f.fractionOf(f.sum(),"row",h),"Sum as Fraction of Columns":f.fractionOf(f.sum(),"col",h),"Count as Fraction of Total":f.fractionOf(f.count(),"total",h),"Count as Fraction of Rows":f.fractionOf(f.count(),"row",h),"Count as Fraction of Columns":f.fractionOf(f.count(),"col",h)},W={en:{aggregators:t,renderers:o={Table:function(t,e){return c(t,e)},"Table Barchart":function(t,e){return _(c(t,e)).barchart()},Heatmap:function(t,e){return _(c(t,e)).heatmap("heatmap",e)},"Row Heatmap":function(t,e){return _(c(t,e)).heatmap("rowheatmap",e)},"Col Heatmap":function(t,e){return _(c(t,e)).heatmap("colheatmap",e)}},localeStrings:{renderError:"An error occurred rendering the PivotTable results.",computeError:"An error occurred computing the PivotTable results.",uiRenderError:"An error occurred rendering the PivotTable UI.",selectAll:"Select All",selectNone:"Select None",tooMany:"(too many to list)",filterResults:"Filter results",totals:"Totals",vs:"vs",by:"by"}}},s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],d=function(t){return("0"+t).substr(-2,2)},e={bin:function(e,n){return function(t){return t[e]-t[e]%n}},dateFormat:function(e,r,t,a,o){var i;return null==t&&(t=!1),null==a&&(a=s),null==o&&(o=n),i=t?"UTC":"",function(t){var n;return n=new Date(Date.parse(t[e])),isNaN(n)?"":r.replace(/%(.)/g,function(t,e){switch(e){case"y":return n["get"+i+"FullYear"]();case"m":return d(n["get"+i+"Month"]()+1);case"n":return a[n["get"+i+"Month"]()];case"d":return d(n["get"+i+"Date"]());case"w":return o[n["get"+i+"Day"]()];case"x":return n["get"+i+"Day"]();case"H":return d(n["get"+i+"Hours"]());case"M":return d(n["get"+i+"Minutes"]());case"S":return d(n["get"+i+"Seconds"]());default:return"%"+e}})}}},G=function(t,e){var n,r,a,o,i,s,l;if(s=/(\d+)|(\D+)/g,i=/\d/,l=/^0/,"number"==typeof t||"number"==typeof e)return isNaN(t)?1:isNaN(e)?-1:t-e;if((n=String(t).toLowerCase())===(a=String(e).toLowerCase()))return 0;if(!i.test(n)||!i.test(a))return a<n?1:-1;for(n=n.match(s),a=a.match(s);n.length&&a.length;)if((r=n.shift())!==(o=a.shift()))return i.test(r)&&i.test(o)?r.replace(l,".0")-o.replace(l,".0"):o<r?1:-1;return n.length-a.length},i=function(t){var e,n,r;for(e in n={},t)r=t[e],n[r]=e;return function(t,e){return null!=n[t]&&null!=n[e]?n[t]-n[e]:null!=n[t]?-1:null!=n[e]?1:G(t,e)}},J=function(t,e){var n;return n=t(e),_.isFunction(n)?n:G},Q=function(){function r(t,e){var n;this.getAggregator=m(this.getAggregator,this),this.getRowKeys=m(this.getRowKeys,this),this.getColKeys=m(this.getColKeys,this),this.sortKeys=m(this.sortKeys,this),this.arrSort=m(this.arrSort,this),this.aggregator=e.aggregator,this.aggregatorName=e.aggregatorName,this.colAttrs=e.cols,this.rowAttrs=e.rows,this.valAttrs=e.vals,this.sorters=e.sorters,this.tree={},this.rowKeys=[],this.colKeys=[],this.rowTotals={},this.colTotals={},this.allTotal=this.aggregator(this,[],[]),this.sorted=!1,r.forEachRecord(t,e.derivedAttributes,(n=this,function(t){if(e.filter(t))return n.processRecord(t)}))}return r.forEachRecord=function(t,a,o){var e,n,r,i,s,l,u,c,p,h,d,f;if(e=_.isEmptyObject(a)?o:function(t){var e,n,r;for(e in a)r=a[e],t[e]=null!=(n=r(t))?n:t[e];return o(t)},_.isFunction(t))return t(e);if(_.isArray(t)){if(_.isArray(t[0])){for(r in h=[],t)if($.call(t,r)&&(n=t[r],0<r)){for(i in c={},p=t[0])$.call(p,i)&&(s=p[i],c[s]=n[i]);h.push(e(c))}return h}for(d=[],l=0,u=t.length;l<u;l++)c=t[l],d.push(e(c));return d}if(t instanceof jQuery)return f=[],_("thead > tr > th",t).each(function(){return f.push(_(this).text())}),_("tbody > tr",t).each(function(){return c={},_("td",this).each(function(t){return c[f[t]]=_(this).text()}),e(c)});throw new Error("unknown input format")},r.convertToArray=function(t){var e;return e=[],r.forEachRecord(t,{},function(t){return e.push(t)}),e},r.prototype.arrSort=function(r){var a,o;return o=function(){var t,e,n;for(n=[],t=0,e=r.length;t<e;t++)a=r[t],n.push(J(this.sorters,a));return n}.call(this),function(t,e){var n,r;for(r in o)if($.call(o,r)&&0!==(n=(0,o[r])(t[r],e[r])))return n;return 0}},r.prototype.sortKeys=function(){if(!this.sorted)return this.sorted=!0,this.rowKeys.sort(this.arrSort(this.rowAttrs)),this.colKeys.sort(this.arrSort(this.colAttrs))},r.prototype.getColKeys=function(){return this.sortKeys(),this.colKeys},r.prototype.getRowKeys=function(){return this.sortKeys(),this.rowKeys},r.prototype.processRecord=function(t){var e,n,r,a,o,i,s,l,u,c,p,h,d;for(e=[],h=[],a=0,o=(l=this.colAttrs).length;a<o;a++)d=l[a],e.push(null!=(u=t[d])?u:"null");for(s=0,i=(c=this.rowAttrs).length;s<i;s++)d=c[s],h.push(null!=(p=t[d])?p:"null");if(r=h.join(String.fromCharCode(0)),n=e.join(String.fromCharCode(0)),this.allTotal.push(t),0!==h.length&&(this.rowTotals[r]||(this.rowKeys.push(h),this.rowTotals[r]=this.aggregator(this,h,[])),this.rowTotals[r].push(t)),0!==e.length&&(this.colTotals[n]||(this.colKeys.push(e),this.colTotals[n]=this.aggregator(this,[],e)),this.colTotals[n].push(t)),0!==e.length&&0!==h.length)return this.tree[r]||(this.tree[r]={}),this.tree[r][n]||(this.tree[r][n]=this.aggregator(this,h,e)),this.tree[r][n].push(t)},r.prototype.getAggregator=function(t,e){var n,r,a;return a=t.join(String.fromCharCode(0)),r=e.join(String.fromCharCode(0)),null!=(n=0===t.length&&0===e.length?this.allTotal:0===t.length?this.colTotals[r]:0===e.length?this.rowTotals[a]:this.tree[a][r])?n:{value:function(){return null},format:function(){return""}}},r}(),_.pivotUtilities={aggregatorTemplates:u,aggregators:t,renderers:o,derivers:e,locales:W,naturalSort:G,numberFormat:a,sortAs:i,PivotData:Q},c=function(t,e){var n,r,a,o,i,s,l,u,c,p,h,d,f,g,m,v,y,b,x,A,C,w,S;for(u in s={localeStrings:{totals:"Totals"}},e=_.extend(s,e),a=t.colAttrs,h=t.rowAttrs,f=t.getRowKeys(),i=t.getColKeys(),(p=document.createElement("table")).className="pvtTable",g=function(t,e,n){var r,a,o,i,s,l,u,c;if(0!==e){for(i=!0,c=r=0,s=n;0<=s?r<=s:s<=r;c=0<=s?++r:--r)t[e-1][c]!==t[e][c]&&(i=!1);if(i)return-1}for(a=0;e+a<t.length;){for(u=!1,c=o=0,l=n;0<=l?o<=l:l<=o;c=0<=l?++o:--o)t[e][c]!==t[e+a][c]&&(u=!0);if(u)break;a++}return a},b=document.createElement("thead"),a)if($.call(a,u)){for(l in r=a[u],A=document.createElement("tr"),0===parseInt(u)&&0!==h.length&&((y=document.createElement("th")).setAttribute("colspan",h.length),y.setAttribute("rowspan",a.length),A.appendChild(y)),(y=document.createElement("th")).className="pvtAxisLabel",y.textContent=r,A.appendChild(y),i)$.call(i,l)&&(o=i[l],-1!==(S=g(i,parseInt(l),parseInt(u)))&&((y=document.createElement("th")).className="pvtColLabel",y.textContent=o[u],y.setAttribute("colspan",S),parseInt(u)===a.length-1&&0!==h.length&&y.setAttribute("rowspan",2),A.appendChild(y)));0===parseInt(u)&&((y=document.createElement("th")).className="pvtTotalLabel",y.innerHTML=e.localeStrings.totals,y.setAttribute("rowspan",a.length+(0===h.length?0:1)),A.appendChild(y)),b.appendChild(A)}if(0!==h.length){for(l in A=document.createElement("tr"),h)$.call(h,l)&&(c=h[l],(y=document.createElement("th")).className="pvtAxisLabel",y.textContent=c,A.appendChild(y));y=document.createElement("th"),0===a.length&&(y.className="pvtTotalLabel",y.innerHTML=e.localeStrings.totals),A.appendChild(y),b.appendChild(A)}for(l in p.appendChild(b),m=document.createElement("tbody"),f)if($.call(f,l)){for(u in d=f[l],A=document.createElement("tr"),d)$.call(d,u)&&(C=d[u],-1!==(S=g(f,parseInt(l),parseInt(u)))&&((y=document.createElement("th")).className="pvtRowLabel",y.textContent=C,y.setAttribute("rowspan",S),parseInt(u)===h.length-1&&0!==a.length&&y.setAttribute("colspan",2),A.appendChild(y)));for(u in i)$.call(i,u)&&(o=i[u],w=(n=t.getAggregator(d,o)).value(),(v=document.createElement("td")).className="pvtVal row"+l+" col"+u,v.textContent=n.format(w),v.setAttribute("data-value",w),A.appendChild(v));w=(x=t.getAggregator(d,[])).value(),(v=document.createElement("td")).className="pvtTotal rowTotal",v.textContent=x.format(w),v.setAttribute("data-value",w),v.setAttribute("data-for","row"+l),A.appendChild(v),m.appendChild(A)}for(u in A=document.createElement("tr"),(y=document.createElement("th")).className="pvtTotalLabel",y.innerHTML=e.localeStrings.totals,y.setAttribute("colspan",h.length+(0===a.length?0:1)),A.appendChild(y),i)$.call(i,u)&&(o=i[u],w=(x=t.getAggregator([],o)).value(),(v=document.createElement("td")).className="pvtTotal colTotal",v.textContent=x.format(w),v.setAttribute("data-value",w),v.setAttribute("data-for","col"+u),A.appendChild(v));return w=(x=t.getAggregator([],[])).value(),(v=document.createElement("td")).className="pvtGrandTotal",v.textContent=x.format(w),v.setAttribute("data-value",w),A.appendChild(v),m.appendChild(A),p.appendChild(m),p.setAttribute("data-numrows",f.length),p.setAttribute("data-numcols",i.length),p},_.fn.pivot=function(t,e){var n,r,a,o,i,s,l;n={cols:[],rows:[],vals:[],dataClass:Q,filter:function(){return!0},aggregator:u.count()(),aggregatorName:"Count",sorters:function(){},derivedAttributes:{},renderer:c,rendererOptions:null,localeStrings:W.en.localeStrings},e=_.extend(n,e),s=null;try{i=new e.dataClass(t,e);try{s=e.renderer(i,e.rendererOptions)}catch(a){r=a,"undefined"!=typeof console&&null!==console&&console.error(r.stack),s=_("<span>").html(e.localeStrings.renderError)}}catch(o){r=o,"undefined"!=typeof console&&null!==console&&console.error(r.stack),s=_("<span>").html(e.localeStrings.computeError)}for(l=this[0];l.hasChildNodes();)l.removeChild(l.lastChild);return this.append(s)},_.fn.pivotUI=function(g,t,e,n){var m,r,v,a,y,o,i,s,l,u,b,x,A,c,p,h,d,f,C,w,S,N,T,F,k,E,j,R,D,q,I,M,K,O,L,U,V,H,B,z,P;null==e&&(e=!1),null==n&&(n="en"),null==W[n]&&(n="en"),o={derivedAttributes:{},aggregators:W[n].aggregators,renderers:W[n].renderers,hiddenAttributes:[],menuLimit:200,cols:[],rows:[],vals:[],dataClass:Q,exclusions:{},inclusions:{},unusedAttrsVertical:85,autoSortUnusedAttrs:!1,rendererOptions:{localeStrings:W[n].localeStrings},onRefresh:null,filter:function(){return!0},sorters:function(){},localeStrings:W[n].localeStrings},l=this.data("pivotUIOptions"),S=null==l||e?_.extend(o,t):l;try{for(a in g=Q.convertToArray(g),O=function(){var t,e;for(A in e=[],t=g[0])$.call(t,A)&&e.push(A);return e}(),F=S.derivedAttributes)$.call(F,a)&&Z.call(O,a)<0&&O.push(a);for(v={},c=0,p=O.length;c<p;c++)z=O[c],v[z]={};for(z in Q.forEachRecord(g,S.derivedAttributes,function(t){var e,n,r;for(A in n=[],t)$.call(t,A)&&(r=t[A],S.filter(t)&&(null==r&&(r="null"),null==(e=v[A])[r]&&(e[r]=0),n.push(v[A][r]++)));return n}),V=_("<table>",{"class":"pvtUi"}).attr("cellpadding",5),M=_("<td>"),I=_("<select>").addClass("pvtRenderer").appendTo(M).bind("change",function(){return D()}),k=S.renderers)$.call(k,z)&&_("<option>").val(z).html(z).appendTo(I);if(y=_("<td>").addClass("pvtAxisContainer pvtUnused"),K=function(){var t,e,n;for(n=[],e=0,t=O.length;e<t;e++)a=O[e],Z.call(S.hiddenAttributes,a)<0&&n.push(a);return n}(),B=!1,H="auto"===S.unusedAttrsVertical?120:parseInt(S.unusedAttrsVertical),!isNaN(H)){for(C=r=0,h=K.length;C<h;C++)r+=K[C].length;B=H<r}for(b in!0===S.unusedAttrsVertical||B?y.addClass("pvtVertList"):y.addClass("pvtHorizList"),u=function(e){var t,n,r,a,o,i,s,l,u,c,p,h,d,f,g;if(s=function(){var t;for(A in t=[],v[e])t.push(A);return t}(),i=!1,(g=_("<div>").addClass("pvtFilterBox").hide()).append(_("<h4>").text(e+" ("+s.length+")")),s.length>S.menuLimit)g.append(_("<p>").html(S.localeStrings.tooMany));else for((n=_("<p>").appendTo(g)).append(_("<button>",{type:"button"}).html(S.localeStrings.selectAll).bind("click",function(){return g.find("input:visible").prop("checked",!0)})),n.append(_("<button>",{type:"button"}).html(S.localeStrings.selectNone).bind("click",function(){return g.find("input:visible").prop("checked",!1)})),n.append(_("<br>")),n.append(_("<input>",{type:"text",placeholder:S.localeStrings.filterResults,"class":"pvtSearch"}).bind("keyup",function(){var t;return t=_(this).val().toLowerCase(),g.find(".pvtCheckContainer p").each(function(){return-1!==_(this).text().toLowerCase().indexOf(t)?_(this).show():_(this).hide()})})),r=_("<div>").addClass("pvtCheckContainer").appendTo(g),u=0,l=(c=s.sort(J(S.sorters,e))).length;u<l;u++)A=c[u],f=v[e][A],a=_("<label>"),o=!1,S.inclusions[e]?o=Z.call(S.inclusions[e],A)<0:S.exclusions[e]&&(o=0<=Z.call(S.exclusions[e],A)),i||(i=o),_("<input>").attr("type","checkbox").addClass("pvtFilter").attr("checked",!o).data("filter",[e,A]).appendTo(a),a.append(_("<span>").text(A)),a.append(_("<span>").text(" ("+f+")")),r.append(_("<p>").append(a));return d=function(){return 0<g.find("[type='checkbox']").length-g.find("[type='checkbox']:checked").length?t.addClass("pvtFilteredAttribute"):t.removeClass("pvtFilteredAttribute"),s.length>S.menuLimit?g.toggle():g.toggle(0,D)},_("<p>").appendTo(g).append(_("<button>",{type:"button"}).text("OK").bind("click",d)),p=function(t){var e,n,r;return e=(r=_(t.currentTarget).position()).left,n=r.top,g.css({left:e+10,top:n+10}).toggle(),g.find(".pvtSearch").val(""),g.find(".pvtCheckContainer p").show()},h=_("<span>").addClass("pvtTriangle").html(" &#x25BE;").bind("click",p),t=_("<li>").addClass("axis_"+b).append(_("<span>").addClass("pvtAttr").text(e).data("attrName",e).append(h)),i&&t.addClass("pvtFilteredAttribute"),y.append(t).append(g),t.bind("dblclick",p)},K)$.call(K,b)&&u(a=K[b]);for(z in L=_("<tr>").appendTo(V),m=_("<select>").addClass("pvtAggregator").bind("change",function(){return D()}),E=S.aggregators)$.call(E,z)&&m.append(_("<option>").val(z).html(z));for(_("<td>").addClass("pvtVals").appendTo(L).append(m).append(_("<br>")),_("<td>").addClass("pvtAxisContainer pvtHorizList pvtCols").appendTo(L),(U=_("<tr>").appendTo(V)).append(_("<td>").addClass("pvtAxisContainer pvtRows").attr("valign","top")),N=_("<td>").attr("valign","top").addClass("pvtRendererArea").appendTo(U),!0===S.unusedAttrsVertical||B?(V.find("tr:nth-child(1)").prepend(M),V.find("tr:nth-child(2)").prepend(y)):V.prepend(_("<tr>").append(M).append(y)),this.html(V),j=S.cols,w=0,d=j.length;w<d;w++)z=j[w],this.find(".pvtCols").append(this.find(".axis_"+_.inArray(z,K)));for(R=S.rows,T=0,f=R.length;T<f;T++)z=R[T],this.find(".pvtRows").append(this.find(".axis_"+_.inArray(z,K)));null!=S.aggregatorName&&this.find(".pvtAggregator").val(S.aggregatorName),null!=S.rendererName&&this.find(".pvtRenderer").val(S.rendererName),x=!0,P=this,q=function(){var t,r,e,n,a,o,i,s,l,u,c,p,h,d,f;if(p={derivedAttributes:S.derivedAttributes,localeStrings:S.localeStrings,rendererOptions:S.rendererOptions,sorters:S.sorters,cols:[],rows:[],dataClass:S.dataClass},o=null!=(l=S.aggregators[m.val()]([])().numInputs)?l:0,f=[],P.find(".pvtRows li span.pvtAttr").each(function(){return p.rows.push(_(this).data("attrName"))}),P.find(".pvtCols li span.pvtAttr").each(function(){return p.cols.push(_(this).data("attrName"))}),P.find(".pvtVals select.pvtAttrDropdown").each(function(){return 0===o?_(this).remove():(o--,""!==_(this).val()?f.push(_(this).val()):void 0)}),0!==o)for(s=P.find(".pvtVals"),z=c=0,u=o;0<=u?c<u:u<c;z=0<=u?++c:--c){for(a=_("<select>").addClass("pvtAttrDropdown").append(_("<option>")).bind("change",function(){return D()}),h=0,n=K.length;h<n;h++)t=K[h],a.append(_("<option>").val(t).text(t));s.append(a)}if(x&&(f=S.vals,b=0,P.find(".pvtVals select.pvtAttrDropdown").each(function(){return _(this).val(f[b]),b++}),x=!1),p.aggregatorName=m.val(),p.vals=f,p.aggregator=S.aggregators[m.val()](f),p.renderer=S.renderers[I.val()],r={},P.find("input.pvtFilter").not(":checked").each(function(){var t;return t=_(this).data("filter"),null!=r[t[0]]?r[t[0]].push(t[1]):r[t[0]]=[t[1]]}),e={},P.find("input.pvtFilter:checked").each(function(){var t;if(t=_(this).data("filter"),null!=r[t[0]])return null!=e[t[0]]?e[t[0]].push(t[1]):e[t[0]]=[t[1]]}),p.filter=function(t){var e,n;if(!S.filter(t))return!1;for(A in r)if(e=r[A],n=""+t[A],0<=Z.call(e,n))return!1;return!0},N.pivot(g,p),i=_.extend(S,{cols:p.cols,rows:p.rows,vals:f,exclusions:r,inclusions:e,inclusionsInfo:e,aggregatorName:m.val(),rendererName:I.val()}),P.data("pivotUIOptions",i),S.autoSortUnusedAttrs&&(d=P.find("td.pvtUnused.pvtAxisContainer"),_(d).children("li").sort(function(t,e){return G(_(t).text(),_(e).text())}).appendTo(d)),N.css("opacity",1),null!=S.onRefresh)return S.onRefresh(i)},(D=function(){return N.css("opacity",.5),setTimeout(q,10)})(),this.find(".pvtAxisContainer").sortable({update:function(t,e){if(null==e.sender)return D()},connectWith:this.find(".pvtAxisContainer"),items:"li",placeholder:"pvtPlaceholder"})}catch(s){i=s,"undefined"!=typeof console&&null!==console&&console.error(i.stack),this.html(S.localeStrings.uiRenderError)}return this},_.fn.heatmap=function(t,e){var a,n,r,o,i,s,l,u,c,p,h,d;switch(null==t&&(t="heatmap"),u=this.data("numrows"),l=this.data("numcols"),null==(a=null!=e&&null!=(c=e.heatmap)?c.colorScaleGenerator:void 0)&&(a=function(t){var n,r;return r=Math.min.apply(Math,t),n=Math.max.apply(Math,t),function(t){var e;return"rgb(255,"+(e=255-Math.round(255*(t-r)/(n-r)))+","+e+")"}}),d=this,n=function(t){var n,e,r;return r=[],(e=function(e){return d.find(t).each(function(){var t;if(null!=(t=_(this).data("value"))&&isFinite(t))return e(t,_(this))})})(function(t){return r.push(t)}),n=a(r),e(function(t,e){return e.css("background-color",n(t))})},t){case"heatmap":n(".pvtVal");break;case"rowheatmap":for(r=i=0,p=u;0<=p?i<p:p<i;r=0<=p?++i:--i)n(".pvtVal.row"+r);break;case"colheatmap":for(o=s=0,h=l;0<=h?s<h:h<s;o=0<=h?++s:--s)n(".pvtVal.col"+o)}return n(".pvtTotal.rowTotal"),n(".pvtTotal.colTotal"),this},_.fn.barchart=function(){var t,e,n,r,a,o;for(r=this.data("numrows"),this.data("numcols"),o=this,t=function(t){var e,n,a,r;return r=[],(e=function(e){return o.find(t).each(function(){var t;if(null!=(t=_(this).data("value"))&&isFinite(t))return e(t,_(this))})})(function(t){return r.push(t)}),n=Math.max.apply(Math,r),a=function(t){return 100*t/(1.4*n)},e(function(t,e){var n,r;return n=e.text(),(r=_("<div>").css({position:"relative",height:"55px"})).append(_("<div>").css({position:"absolute",bottom:0,left:0,right:0,height:a(t)+"%","background-color":"gray"})),r.append(_("<div>").text(n).css({position:"relative","padding-left":"5px","padding-right":"5px"})),e.css({padding:0,"padding-top":"5px","text-align":"center"}).html(r)})},e=n=0,a=r;0<=a?n<a:a<n;e=0<=a?++n:--n)t(".pvtVal.row"+e);return t(".pvtTotal.colTotal"),this}})}.call(this);