(function(){var Z=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1},b=[].slice,C=function(t,e){return function(){return t.apply(e,arguments)}},tt={}.hasOwnProperty;(function(t){"object"==typeof exports&&"object"==typeof module?t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)})(function(G){var Q,r,f,t,n,e,$,Y,s,X,d,h,l,a,u,c,o,p,i,m,v,g;return r=function(t,e,n){var r,a,o,i;for(o=(a=(t+="").split("."))[0],i=1<a.length?n+a[1]:"",r=/(\d+)(\d{3})/;r.test(o);)o=o.replace(r,"$1"+e+"$2");return o+i},p=(d=function(n){var t;return t={digitsAfterDecimal:2,scaler:1,thousandsSep:",",decimalSep:".",prefix:"",suffix:""},n=G.extend({},t,n),function(t){var e;return isNaN(t)||!isFinite(t)?"":(e=r((n.scaler*t).toFixed(n.digitsAfterDecimal),n.thousandsSep,n.decimalSep),""+n.prefix+e+n.suffix)}})(),i=d({digitsAfterDecimal:0}),m=d({digitsAfterDecimal:1,scaler:100,suffix:"%"}),t={Count:(g=f={count:function(t){return null==t&&(t=i),function(){return function(){return{count:0,push:function(){return this.count++},value:function(){return this.count},format:t}}}},uniques:function(e,r){return null==r&&(r=i),function(t){var n;return n=t[0],function(){return{uniq:[],push:function(t){var e;return e=t[n],Z.call(this.uniq,e)<0?this.uniq.push(t[n]):void 0},value:function(){return e(this.uniq)},format:r,numInputs:null!=n?0:1}}}},sum:function(n){return null==n&&(n=p),function(t){var e;return e=t[0],function(){return{sum:0,push:function(t){return isNaN(parseFloat(t[e]))?void 0:this.sum+=parseFloat(t[e])},value:function(){return this.sum},format:n,numInputs:null!=e?0:1}}}},extremes:function(i,e){return null==e&&(e=p),function(t){var o;return o=t[0],function(t){return{val:null,sorter:$(null!=t?t.sorters:void 0,o),push:function(t){var e,n,r,a;return a=t[o],("min"===i||"max"===i)&&(a=parseFloat(a),isNaN(a)||(this.val=Math[i](a,null!=(e=this.val)?e:a))),"first"===i&&this.sorter(a,null!=(n=this.val)?n:a)<=0&&(this.val=a),"last"===i&&0<=this.sorter(a,null!=(r=this.val)?r:a)?this.val=a:void 0},value:function(){return this.val},format:function(t){return isNaN(t)?t:e(t)},numInputs:null!=o?0:1}}}},quantile:function(e,r){return null==r&&(r=p),function(t){var n;return n=t[0],function(){return{vals:[],push:function(t){var e;return e=parseFloat(t[n]),isNaN(e)?void 0:this.vals.push(e)},value:function(){var t;return 0===this.vals.length?null:(this.vals.sort(function(t,e){return t-e}),t=(this.vals.length-1)*e,(this.vals[Math.floor(t)]+this.vals[Math.ceil(t)])/2)},format:r,numInputs:null!=n?0:1}}}},runningStat:function(e,n,a){return null==e&&(e="mean"),null==n&&(n=1),null==a&&(a=p),function(t){var r;return r=t[0],function(){return{n:0,m:0,s:0,push:function(t){var e,n;return n=parseFloat(t[r]),isNaN(n)?void 0:(this.n+=1,1===this.n?this.m=n:(e=this.m+(n-this.m)/this.n,this.s=this.s+(n-this.m)*(n-e),this.m=e))},value:function(){if("mean"===e)return 0===this.n?NaN:this.m;if(this.n<=n)return 0;switch(e){case"var":return this.s/(this.n-n);case"stdev":return Math.sqrt(this.s/(this.n-n))}},format:a,numInputs:null!=r?0:1}}}},sumOverSum:function(r){return null==r&&(r=p),function(t){var e,n;return n=t[0],e=t[1],function(){return{sumNum:0,sumDenom:0,push:function(t){return isNaN(parseFloat(t[n]))||(this.sumNum+=parseFloat(t[n])),isNaN(parseFloat(t[e]))?void 0:this.sumDenom+=parseFloat(t[e])},value:function(){return this.sumNum/this.sumDenom},format:r,numInputs:null!=n&&null!=e?0:2}}}},sumOverSumBound80:function(r,a){return null==r&&(r=!0),null==a&&(a=p),function(t){var e,n;return n=t[0],e=t[1],function(){return{sumNum:0,sumDenom:0,push:function(t){return isNaN(parseFloat(t[n]))||(this.sumNum+=parseFloat(t[n])),isNaN(parseFloat(t[e]))?void 0:this.sumDenom+=parseFloat(t[e])},value:function(){var t;return t=r?1:-1,(.821187207574908/this.sumDenom+this.sumNum/this.sumDenom+1.2815515655446004*t*Math.sqrt(.410593603787454/(this.sumDenom*this.sumDenom)+this.sumNum*(1-this.sumNum/this.sumDenom)/(this.sumDenom*this.sumDenom)))/(1+1.642374415149816/this.sumDenom)},format:a,numInputs:null!=n&&null!=e?0:2}}}},fractionOf:function(a,o,i){return null==o&&(o="total"),null==i&&(i=m),function(){var r;return r=1<=arguments.length?b.call(arguments,0):[],function(t,e,n){return{selector:{total:[[],[]],row:[e,[]],col:[[],n]}[o],inner:a.apply(null,r)(t,e,n),push:function(t){return this.inner.push(t)},format:i,value:function(){return this.inner.value()/t.getAggregator.apply(t,this.selector).inner.value()},numInputs:a.apply(null,r)().numInputs}}}},countUnique:function(t){return f.uniques(function(t){return t.length},t)},listUnique:function(e){return f.uniques(function(t){return t.join(e)},function(t){return t})},max:function(t){return f.extremes("max",t)},min:function(t){return f.extremes("min",t)},first:function(t){return f.extremes("first",t)},last:function(t){return f.extremes("last",t)},median:function(t){return f.quantile(.5,t)},average:function(t){return f.runningStat("mean",1,t)},"var":function(t,e){return f.runningStat("var",t,e)},stdev:function(t,e){return f.runningStat("stdev",t,e)}}).count(i),"Count Unique Values":g.countUnique(i),"List Unique Values":g.listUnique(", "),Sum:g.sum(p),"Integer Sum":g.sum(i),Average:g.average(p),Median:g.median(p),"Sample Variance":g["var"](1,p),"Sample Standard Deviation":g.stdev(1,p),Minimum:g.min(p),Maximum:g.max(p),First:g.first(p),Last:g.last(p),"Sum over Sum":g.sumOverSum(p),"80% Upper Bound":g.sumOverSumBound80(!0,p),"80% Lower Bound":g.sumOverSumBound80(!1,p),"Sum as Fraction of Total":g.fractionOf(g.sum(),"total",m),"Sum as Fraction of Rows":g.fractionOf(g.sum(),"row",m),"Sum as Fraction of Columns":g.fractionOf(g.sum(),"col",m),"Count as Fraction of Total":g.fractionOf(g.count(),"total",m),"Count as Fraction of Rows":g.fractionOf(g.count(),"row",m),"Count as Fraction of Columns":g.fractionOf(g.count(),"col",m)},Y={en:{aggregators:t,renderers:a={Table:function(t,e){return h(t,e)},"Table Barchart":function(t,e){return G(h(t,e)).barchart()},Heatmap:function(t,e){return G(h(t,e)).heatmap("heatmap",e)},"Row Heatmap":function(t,e){return G(h(t,e)).heatmap("rowheatmap",e)},"Col Heatmap":function(t,e){return G(h(t,e)).heatmap("colheatmap",e)}},localeStrings:{renderError:"An error occurred rendering the PivotTable results.",computeError:"An error occurred computing the PivotTable results.",uiRenderError:"An error occurred rendering the PivotTable UI.",selectAll:"Select All",selectNone:"Select None",tooMany:"(too many to list)",filterResults:"Filter values",apply:"Apply",cancel:"Cancel",totals:"Totals",vs:"vs",by:"by"}}},s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],v=function(t){return("0"+t).substr(-2,2)},e={bin:function(e,n){return function(t){return t[e]-t[e]%n}},dateFormat:function(e,r,t,a,o){var i;return null==t&&(t=!1),null==a&&(a=s),null==o&&(o=n),i=t?"UTC":"",function(t){var n;return n=new Date(Date.parse(t[e])),isNaN(n)?"":r.replace(/%(.)/g,function(t,e){switch(e){case"y":return n["get"+i+"FullYear"]();case"m":return v(n["get"+i+"Month"]()+1);case"n":return a[n["get"+i+"Month"]()];case"d":return v(n["get"+i+"Date"]());case"w":return o[n["get"+i+"Day"]()];case"x":return n["get"+i+"Day"]();case"H":return v(n["get"+i+"Hours"]());case"M":return v(n["get"+i+"Minutes"]());case"S":return v(n["get"+i+"Seconds"]());default:return"%"+e}})}}},u=/(\d+)|(\D+)/g,l=/\d/,c=/^0/,X=function(t,e){var n,r,a,o,i,s;if(null!=e&&null==t)return-1;if(null!=t&&null==e)return 1;if("number"==typeof t&&isNaN(t))return-1;if("number"==typeof e&&isNaN(e))return 1;if((i=+t)<(s=+e))return-1;if(s<i)return 1;if("number"==typeof t&&"number"!=typeof e)return-1;if("number"==typeof e&&"number"!=typeof t)return 1;if("number"==typeof t&&"number"==typeof e)return 0;if(isNaN(s)&&!isNaN(i))return-1;if(isNaN(i)&&!isNaN(s))return 1;if((n=String(t))===(a=String(e)))return 0;if(!l.test(n)||!l.test(a))return a<n?1:-1;for(n=n.match(u),a=a.match(u);n.length&&a.length;)if((r=n.shift())!==(o=a.shift()))return l.test(r)&&l.test(o)?r.replace(c,".0")-o.replace(c,".0"):o<r?1:-1;return n.length-a.length},o=function(t){var e,n,r,a;for(e in r={},n={},t)a=t[e],r[a]=e,"string"==typeof a&&(n[a.toLowerCase()]=e);return function(t,e){return null!=r[t]&&null!=r[e]?r[t]-r[e]:null!=r[t]?-1:null!=r[e]?1:null!=n[t]&&null!=n[e]?n[t]-n[e]:null!=n[t]?-1:null!=n[e]?1:X(t,e)}},$=function(t,e){var n;if(null!=t)if(G.isFunction(t)){if(n=t(e),G.isFunction(n))return n}else if(null!=t[e])return t[e];return X},Q=function(){function p(t,e){var n,r,a,o,i,s,l,u,c,d,h;null==e&&(e={}),this.getAggregator=C(this.getAggregator,this),this.getRowKeys=C(this.getRowKeys,this),this.getColKeys=C(this.getColKeys,this),this.sortKeys=C(this.sortKeys,this),this.arrSort=C(this.arrSort,this),this.input=t,this.aggregator=null!=(n=e.aggregator)?n:f.count()(),this.aggregatorName=null!=(r=e.aggregatorName)?r:"Count",this.colAttrs=null!=(a=e.cols)?a:[],this.rowAttrs=null!=(o=e.rows)?o:[],this.valAttrs=null!=(i=e.vals)?i:[],this.sorters=null!=(s=e.sorters)?s:{},this.rowOrder=null!=(l=e.rowOrder)?l:"key_a_to_z",this.colOrder=null!=(u=e.colOrder)?u:"key_a_to_z",this.derivedAttributes=null!=(c=e.derivedAttributes)?c:{},this.filter=null!=(d=e.filter)?d:function(){return!0},this.tree={},this.rowKeys=[],this.colKeys=[],this.rowTotals={},this.colTotals={},this.allTotal=this.aggregator(this,[],[]),this.sorted=!1,p.forEachRecord(this.input,this.derivedAttributes,(h=this,function(t){return h.filter(t)?h.processRecord(t):void 0}))}return p.forEachRecord=function(t,a,o){var e,n,r,i,s,l,u,c,d,h,p,f;if(e=G.isEmptyObject(a)?o:function(t){var e,n,r;for(e in a)r=a[e],t[e]=null!=(n=r(t))?n:t[e];return o(t)},G.isFunction(t))return t(e);if(G.isArray(t)){if(G.isArray(t[0])){for(r in h=[],t)if(tt.call(t,r)&&(n=t[r],0<r)){for(i in c={},d=t[0])tt.call(d,i)&&(s=d[i],c[s]=n[i]);h.push(e(c))}return h}for(p=[],l=0,u=t.length;l<u;l++)c=t[l],p.push(e(c));return p}if(t instanceof jQuery)return f=[],G("thead > tr > th",t).each(function(){return f.push(G(this).text())}),G("tbody > tr",t).each(function(){return c={},G("td",this).each(function(t){return c[f[t]]=G(this).text()}),e(c)});throw new Error("unknown input format")},p.prototype.forEachMatchingRecord=function(r,a){return p.forEachRecord(this.input,this.derivedAttributes,(o=this,function(t){var e,n;if(o.filter(t)){for(e in r)if(r[e]!==(null!=(n=t[e])?n:"null"))return;return a(t)}}));var o},p.prototype.arrSort=function(r){var a,o;return o=function(){var t,e,n;for(n=[],t=0,e=r.length;t<e;t++)a=r[t],n.push($(this.sorters,a));return n}.call(this),function(t,e){var n,r;for(r in o)if(tt.call(o,r)&&0!==(n=(0,o[r])(t[r],e[r])))return n;return 0}},p.prototype.sortKeys=function(){var n,r;if(!this.sorted){switch(this.sorted=!0,n=function(t,e){return r.getAggregator(t,e).value()},(r=this).rowOrder){case"value_a_to_z":this.rowKeys.sort(function(t,e){return X(n(t,[]),n(e,[]))});break;case"value_z_to_a":this.rowKeys.sort(function(t,e){return-X(n(t,[]),n(e,[]))});break;default:this.rowKeys.sort(this.arrSort(this.rowAttrs))}switch(this.colOrder){case"value_a_to_z":return this.colKeys.sort(function(t,e){return X(n([],t),n([],e))});case"value_z_to_a":return this.colKeys.sort(function(t,e){return-X(n([],t),n([],e))});default:return this.colKeys.sort(this.arrSort(this.colAttrs))}}},p.prototype.getColKeys=function(){return this.sortKeys(),this.colKeys},p.prototype.getRowKeys=function(){return this.sortKeys(),this.rowKeys},p.prototype.processRecord=function(t){var e,n,r,a,o,i,s,l,u,c,d,h,p;for(e=[],h=[],a=0,o=(l=this.colAttrs).length;a<o;a++)p=l[a],e.push(null!=(u=t[p])?u:"null");for(s=0,i=(c=this.rowAttrs).length;s<i;s++)p=c[s],h.push(null!=(d=t[p])?d:"null");return r=h.join(String.fromCharCode(0)),n=e.join(String.fromCharCode(0)),this.allTotal.push(t),0!==h.length&&(this.rowTotals[r]||(this.rowKeys.push(h),this.rowTotals[r]=this.aggregator(this,h,[])),this.rowTotals[r].push(t)),0!==e.length&&(this.colTotals[n]||(this.colKeys.push(e),this.colTotals[n]=this.aggregator(this,[],e)),this.colTotals[n].push(t)),0!==e.length&&0!==h.length?(this.tree[r]||(this.tree[r]={}),this.tree[r][n]||(this.tree[r][n]=this.aggregator(this,h,e)),this.tree[r][n].push(t)):void 0},p.prototype.getAggregator=function(t,e){var n,r,a;return a=t.join(String.fromCharCode(0)),r=e.join(String.fromCharCode(0)),null!=(n=0===t.length&&0===e.length?this.allTotal:0===t.length?this.colTotals[r]:0===e.length?this.rowTotals[a]:this.tree[a][r])?n:{value:function(){return null},format:function(){return""}}},p}(),G.pivotUtilities={aggregatorTemplates:f,aggregators:t,renderers:a,derivers:e,locales:Y,naturalSort:X,numberFormat:d,sortAs:o,PivotData:Q},h=function(i,s){var t,e,l,n,r,a,o,u,c,d,h,p,f,m,v,g,b,C,y,w,A,x,S,N;for(c in a={table:{clickCallback:null},localeStrings:{totals:"Totals"}},s=G.extend(!0,{},a,s),l=i.colAttrs,p=i.rowAttrs,m=i.getRowKeys(),r=i.getColKeys(),s.table.clickCallback&&(o=function(e,t,n){var r,a,o;for(o in a={},l)tt.call(l,o)&&(r=l[o],null!=n[o]&&(a[r]=n[o]));for(o in p)tt.call(p,o)&&(r=p[o],null!=t[o]&&(a[r]=t[o]));return function(t){return s.table.clickCallback(t,e,a,i)}}),(h=document.createElement("table")).className="pvtTable",v=function(t,e,n){var r,a,o,i,s,l,u,c;if(0!==e){for(i=!0,c=r=0,s=n;0<=s?r<=s:s<=r;c=0<=s?++r:--r)t[e-1][c]!==t[e][c]&&(i=!1);if(i)return-1}for(a=0;e+a<t.length;){for(u=!1,c=o=0,l=n;0<=l?o<=l:l<=o;c=0<=l?++o:--o)t[e][c]!==t[e+a][c]&&(u=!0);if(u)break;a++}return a},y=document.createElement("thead"),l)if(tt.call(l,c)){for(u in e=l[c],A=document.createElement("tr"),0===parseInt(c)&&0!==p.length&&((C=document.createElement("th")).setAttribute("colspan",p.length),C.setAttribute("rowspan",l.length),A.appendChild(C)),(C=document.createElement("th")).className="pvtAxisLabel",C.textContent=e,A.appendChild(C),r)tt.call(r,u)&&(n=r[u],-1!==(N=v(r,parseInt(u),parseInt(c)))&&((C=document.createElement("th")).className="pvtColLabel",C.textContent=n[c],C.setAttribute("colspan",N),parseInt(c)===l.length-1&&0!==p.length&&C.setAttribute("rowspan",2),A.appendChild(C)));0===parseInt(c)&&((C=document.createElement("th")).className="pvtTotalLabel",C.innerHTML=s.localeStrings.totals,C.setAttribute("rowspan",l.length+(0===p.length?0:1)),A.appendChild(C)),y.appendChild(A)}if(0!==p.length){for(u in A=document.createElement("tr"),p)tt.call(p,u)&&(d=p[u],(C=document.createElement("th")).className="pvtAxisLabel",C.textContent=d,A.appendChild(C));C=document.createElement("th"),0===l.length&&(C.className="pvtTotalLabel",C.innerHTML=s.localeStrings.totals),A.appendChild(C),y.appendChild(A)}for(u in h.appendChild(y),g=document.createElement("tbody"),m)if(tt.call(m,u)){for(c in f=m[u],A=document.createElement("tr"),f)tt.call(f,c)&&(x=f[c],-1!==(N=v(m,parseInt(u),parseInt(c)))&&((C=document.createElement("th")).className="pvtRowLabel",C.textContent=x,C.setAttribute("rowspan",N),parseInt(c)===p.length-1&&0!==l.length&&C.setAttribute("colspan",2),A.appendChild(C)));for(c in r)tt.call(r,c)&&(n=r[c],S=(t=i.getAggregator(f,n)).value(),(b=document.createElement("td")).className="pvtVal row"+u+" col"+c,b.textContent=t.format(S),b.setAttribute("data-value",S),null!=o&&(b.onclick=o(S,f,n)),A.appendChild(b));S=(w=i.getAggregator(f,[])).value(),(b=document.createElement("td")).className="pvtTotal rowTotal",b.textContent=w.format(S),b.setAttribute("data-value",S),null!=o&&(b.onclick=o(S,f,[])),b.setAttribute("data-for","row"+u),A.appendChild(b),g.appendChild(A)}for(c in A=document.createElement("tr"),(C=document.createElement("th")).className="pvtTotalLabel",C.innerHTML=s.localeStrings.totals,C.setAttribute("colspan",p.length+(0===l.length?0:1)),A.appendChild(C),r)tt.call(r,c)&&(n=r[c],S=(w=i.getAggregator([],n)).value(),(b=document.createElement("td")).className="pvtTotal colTotal",b.textContent=w.format(S),b.setAttribute("data-value",S),null!=o&&(b.onclick=o(S,[],n)),b.setAttribute("data-for","col"+c),A.appendChild(b));return S=(w=i.getAggregator([],[])).value(),(b=document.createElement("td")).className="pvtGrandTotal",b.textContent=w.format(S),b.setAttribute("data-value",S),null!=o&&(b.onclick=o(S,[],[])),A.appendChild(b),g.appendChild(A),h.appendChild(g),h.setAttribute("data-numrows",m.length),h.setAttribute("data-numcols",r.length),h},G.fn.pivot=function(t,e,n){var r,a,o,i,s,l,u,c;null==n&&(n="en"),null==Y[n]&&(n="en"),r={cols:[],rows:[],vals:[],rowOrder:"key_a_to_z",colOrder:"key_a_to_z",dataClass:Q,filter:function(){return!0},aggregator:f.count()(),aggregatorName:"Count",sorters:{},derivedAttributes:{},renderer:h},o={rendererOptions:{localeStrings:i=G.extend(!0,{},Y.en.localeStrings,Y[n].localeStrings)},localeStrings:i},s=G.extend(!0,{},o,G.extend({},r,e)),u=null;try{l=new s.dataClass(t,s);try{u=s.renderer(l,s.rendererOptions)}catch(d){a=d,"undefined"!=typeof console&&null!==console&&console.error(a.stack),u=G("<span>").html(s.localeStrings.renderError)}}catch(d){a=d,"undefined"!=typeof console&&null!==console&&console.error(a.stack),u=G("<span>").html(s.localeStrings.computeError)}for(c=this[0];c.hasChildNodes();)c.removeChild(c.lastChild);return this.append(u)},G.fn.pivotUI=function(t,e,n,r){var a,f,m,o,y,v,i,s,l,u,w,g,c,d,h,p,b,C,A,x,S,N,T,k,_,O,F,E,D,M,R,I,K,L,q,z,U,V,j,H,B,W,P;null==n&&(n=!1),null==r&&(r="en"),null==Y[r]&&(r="en"),i={derivedAttributes:{},aggregators:Y[r].aggregators,renderers:Y[r].renderers,hiddenAttributes:[],menuLimit:500,cols:[],rows:[],vals:[],rowOrder:"key_a_to_z",colOrder:"key_a_to_z",dataClass:Q,exclusions:{},inclusions:{},unusedAttrsVertical:85,autoSortUnusedAttrs:!1,onRefresh:null,filter:function(){return!0},sorters:{}},b={rendererOptions:{localeStrings:C=G.extend(!0,{},Y.en.localeStrings,Y[r].localeStrings)},localeStrings:C},l=this.data("pivotUIOptions"),N=null==l||n?G.extend(!0,{},b,G.extend({},i,e)):l;try{for(W in y={},A=[],_=0,Q.forEachRecord(t,N.derivedAttributes,function(t){var e,n,r,a;if(N.filter(t)){for(e in A.push(t),t)tt.call(t,e)&&null==y[e]&&(y[e]={},0<_&&(y[e]["null"]=_));for(e in y)a=null!=(r=t[e])?r:"null",null==(n=y[e])[a]&&(n[a]=0),y[e][a]++;return _++}}),V=G("<table>",{"class":"pvtUi"}).attr("cellpadding",5),K=G("<td>"),I=G("<select>").addClass("pvtRenderer").appendTo(K).bind("change",function(){return M()}),O=N.renderers)tt.call(O,W)&&G("<option>").val(W).html(W).appendTo(I);if(j=G("<td>").addClass("pvtAxisContainer pvtUnused"),q=function(){var t;for(a in t=[],y)Z.call(N.hiddenAttributes,a)<0&&t.push(a);return t}(),B=!1,H="auto"===N.unusedAttrsVertical?120:parseInt(N.unusedAttrsVertical),!isNaN(H)){for(c=o=0,d=q.length;c<d;c++)o+=(a=q[c]).length;B=H<o}for(w in j.addClass(!0===N.unusedAttrsVertical||B?"pvtVertList":"pvtHorizList"),u=function(e){var t,n,r,a,o,i,s,l,u,c,d,h,p,f,m,v,g,b,C;if(C=function(){var t;for(m in t=[],y[e])t.push(m);return t}(),l=!1,(b=G("<div>").addClass("pvtFilterBox").hide()).append(G("<h4>").append(G("<span>").text(e),G("<span>").addClass("count").text("("+C.length+")"))),C.length>N.menuLimit)b.append(G("<p>").html(N.localeStrings.tooMany));else for(5<C.length&&(a=G("<p>").appendTo(b),p=$(N.sorters,e),d=N.localeStrings.filterResults,G("<input>",{type:"text"}).appendTo(a).attr({placeholder:d,"class":"pvtSearch"}).bind("keyup",function(){var t,e,o;return o=G(this).val().toLowerCase().trim(),e=function(r,a){return function(t){var e,n;return 0===(e=o.substring(r.length).trim()).length||(n=Math.sign(p(t.toLowerCase(),e)),0<=Z.call(a,n))}},t=o.startsWith(">=")?e(">=",[1,0]):o.startsWith("<=")?e("<=",[-1,0]):o.startsWith(">")?e(">",[1]):o.startsWith("<")?e("<",[-1]):o.startsWith("~")?function(t){return 0===o.substring(1).trim().length||t.toLowerCase().match(o.substring(1))}:function(t){return-1!==t.toLowerCase().indexOf(o)},b.find(".pvtCheckContainer p label span.value").each(function(){return t(G(this).text())?G(this).parent().parent().show():G(this).parent().parent().hide()})}),a.append(G("<br>")),G("<button>",{type:"button"}).appendTo(a).html(N.localeStrings.selectAll).bind("click",function(){return b.find("input:visible:not(:checked)").prop("checked",!0).toggleClass("changed"),!1}),G("<button>",{type:"button"}).appendTo(a).html(N.localeStrings.selectNone).bind("click",function(){return b.find("input:visible:checked").prop("checked",!1).toggleClass("changed"),!1})),n=G("<div>").addClass("pvtCheckContainer").appendTo(b),c=0,u=(h=C.sort($(N.sorters,e))).length;c<u;c++)v=h[c],g=y[e][v],o=G("<label>"),i=!1,N.inclusions[e]?i=Z.call(N.inclusions[e],v)<0:N.exclusions[e]&&(i=0<=Z.call(N.exclusions[e],v)),l||(l=i),G("<input>").attr("type","checkbox").addClass("pvtFilter").attr("checked",!i).data("filter",[e,v]).appendTo(o).bind("change",function(){return G(this).toggleClass("changed")}),o.append(G("<span>").addClass("value").text(v)),o.append(G("<span>").addClass("count").text("("+g+")")),n.append(G("<p>").append(o));return r=function(){return b.find("[type='checkbox']").length>b.find("[type='checkbox']:checked").length?t.addClass("pvtFilteredAttribute"):t.removeClass("pvtFilteredAttribute"),b.find(".pvtSearch").val(""),b.find(".pvtCheckContainer p").show(),b.hide()},s=G("<p>").appendTo(b),C.length<=N.menuLimit&&G("<button>",{type:"button"}).text(N.localeStrings.apply).appendTo(s).bind("click",function(){return b.find(".changed").removeClass("changed").length&&M(),r()}),G("<button>",{type:"button"}).text(N.localeStrings.cancel).appendTo(s).bind("click",function(){return b.find(".changed:checked").removeClass("changed").prop("checked",!1),b.find(".changed:not(:checked)").removeClass("changed").prop("checked",!0),r()}),f=G("<span>").addClass("pvtTriangle").html(" &#x25BE;").bind("click",function(t){var e,n,r;return e=(n=G(t.currentTarget).position()).left,r=n.top,b.css({left:e+10,top:r+10}).show()}),t=G("<li>").addClass("axis_"+w).append(G("<span>").addClass("pvtAttr").text(e).data("attrName",e).append(f)),l&&t.addClass("pvtFilteredAttribute"),j.append(t).append(b)},q)tt.call(q,w)&&u(m=q[w]);for(W in z=G("<tr>").appendTo(V),f=G("<select>").addClass("pvtAggregator").bind("change",function(){return M()}),F=N.aggregators)tt.call(F,W)&&f.append(G("<option>").val(W).html(W));for(T={key_a_to_z:{rowSymbol:"&varr;",colSymbol:"&harr;",next:"value_a_to_z"},value_a_to_z:{rowSymbol:"&darr;",colSymbol:"&rarr;",next:"value_z_to_a"},value_z_to_a:{rowSymbol:"&uarr;",colSymbol:"&larr;",next:"key_a_to_z"}},L=G("<a>",{role:"button"}).addClass("pvtRowOrder").data("order",N.rowOrder).html(T[N.rowOrder].rowSymbol).bind("click",function(){return G(this).data("order",T[G(this).data("order")].next),G(this).html(T[G(this).data("order")].rowSymbol),M()}),v=G("<a>",{role:"button"}).addClass("pvtColOrder").data("order",N.colOrder).html(T[N.colOrder].colSymbol).bind("click",function(){return G(this).data("order",T[G(this).data("order")].next),G(this).html(T[G(this).data("order")].colSymbol),M()}),G("<td>").addClass("pvtVals").appendTo(z).append(f).append(L).append(v).append(G("<br>")),G("<td>").addClass("pvtAxisContainer pvtHorizList pvtCols").appendTo(z),(U=G("<tr>").appendTo(V)).append(G("<td>").addClass("pvtAxisContainer pvtRows").attr("valign","top")),k=G("<td>").attr("valign","top").addClass("pvtRendererArea").appendTo(U),!0===N.unusedAttrsVertical||B?(V.find("tr:nth-child(1)").prepend(K),V.find("tr:nth-child(2)").prepend(j)):V.prepend(G("<tr>").append(K).append(j)),this.html(V),E=N.cols,x=0,h=E.length;x<h;x++)W=E[x],this.find(".pvtCols").append(this.find(".axis_"+G.inArray(W,q)));for(D=N.rows,S=0,p=D.length;S<p;S++)W=D[S],this.find(".pvtRows").append(this.find(".axis_"+G.inArray(W,q)));null!=N.aggregatorName&&this.find(".pvtAggregator").val(N.aggregatorName),null!=N.rendererName&&this.find(".pvtRenderer").val(N.rendererName),g=!0,P=this,R=function(){var o,e,t,n,r,a,i,s,l,u,c,d,h,p;if(u={derivedAttributes:N.derivedAttributes,localeStrings:N.localeStrings,rendererOptions:N.rendererOptions,sorters:N.sorters,cols:[],rows:[],dataClass:N.dataClass},r=null!=(s=N.aggregators[f.val()]([])().numInputs)?s:0,p=[],P.find(".pvtRows li span.pvtAttr").each(function(){return u.rows.push(G(this).data("attrName"))}),P.find(".pvtCols li span.pvtAttr").each(function(){return u.cols.push(G(this).data("attrName"))}),P.find(".pvtVals select.pvtAttrDropdown").each(function(){return 0===r?G(this).remove():(r--,""!==G(this).val()?p.push(G(this).val()):void 0)}),0!==r)for(i=P.find(".pvtVals"),W=c=0,l=r;0<=l?c<l:l<c;W=0<=l?++c:--c){for(n=G("<select>").addClass("pvtAttrDropdown").append(G("<option>")).bind("change",function(){return M()}),d=0,t=q.length;d<t;d++)m=q[d],n.append(G("<option>").val(m).text(m));i.append(n)}return g&&(p=N.vals,w=0,P.find(".pvtVals select.pvtAttrDropdown").each(function(){return G(this).val(p[w]),w++}),g=!1),u.aggregatorName=f.val(),u.vals=p,u.aggregator=N.aggregators[f.val()](p),u.renderer=N.renderers[I.val()],u.rowOrder=L.data("order"),u.colOrder=v.data("order"),o={},P.find("input.pvtFilter").not(":checked").each(function(){var t;return t=G(this).data("filter"),null!=o[t[0]]?o[t[0]].push(t[1]):o[t[0]]=[t[1]]}),e={},P.find("input.pvtFilter:checked").each(function(){var t;return t=G(this).data("filter"),null!=o[t[0]]?null!=e[t[0]]?e[t[0]].push(t[1]):e[t[0]]=[t[1]]:void 0}),u.filter=function(t){var e,n,r,a;if(!N.filter(t))return!1;for(n in o)if(e=o[n],r=""+(null!=(a=t[n])?a:"null"),0<=Z.call(e,r))return!1;return!0},k.pivot(A,u),a=G.extend({},N,{cols:u.cols,rows:u.rows,colOrder:u.colOrder,rowOrder:u.rowOrder,vals:p,exclusions:o,inclusions:e,inclusionsInfo:e,aggregatorName:f.val(),rendererName:I.val()}),P.data("pivotUIOptions",a),N.autoSortUnusedAttrs&&(h=P.find("td.pvtUnused.pvtAxisContainer"),G(h).children("li").sort(function(t,e){return X(G(t).text(),G(e).text())}).appendTo(h)),k.css("opacity",1),null!=N.onRefresh?N.onRefresh(a):void 0},(M=function(){return k.css("opacity",.5),setTimeout(R,10)})(),this.find(".pvtAxisContainer").sortable({update:function(t,e){return null==e.sender?M():void 0},connectWith:this.find(".pvtAxisContainer"),items:"li",placeholder:"pvtPlaceholder"})}catch(J){s=J,"undefined"!=typeof console&&null!==console&&console.error(s.stack),this.html(N.localeStrings.uiRenderError)}return this},G.fn.heatmap=function(t,e){var a,n,r,o,i,s,l,u,c,d,h,p;switch(null==t&&(t="heatmap"),u=this.data("numrows"),l=this.data("numcols"),null==(a=null!=e&&null!=(c=e.heatmap)?c.colorScaleGenerator:void 0)&&(a=function(t){var n,r;return r=Math.min.apply(Math,t),n=Math.max.apply(Math,t),function(t){var e;return"rgb(255,"+(e=255-Math.round(255*(t-r)/(n-r)))+","+e+")"}}),p=this,n=function(t){var n,e,r;return r=[],(e=function(e){return p.find(t).each(function(){var t;return null!=(t=G(this).data("value"))&&isFinite(t)?e(t,G(this)):void 0})})(function(t){return r.push(t)}),n=a(r),e(function(t,e){return e.css("background-color",n(t))})},t){case"heatmap":n(".pvtVal");break;case"rowheatmap":for(r=i=0,d=u;0<=d?i<d:d<i;r=0<=d?++i:--i)n(".pvtVal.row"+r);break;case"colheatmap":for(o=s=0,h=l;0<=h?s<h:h<s;o=0<=h?++s:--s)n(".pvtVal.col"+o)}return n(".pvtTotal.rowTotal"),n(".pvtTotal.colTotal"),this},G.fn.barchart=function(){var t,e,n,r,a;for(r=this.data("numrows"),this.data("numcols"),t=function(o){return function(t){var e,n,a,r;return r=[],(e=function(e){return o.find(t).each(function(){var t;return null!=(t=G(this).data("value"))&&isFinite(t)?e(t,G(this)):void 0})})(function(t){return r.push(t)}),n=Math.max.apply(Math,r),a=function(t){return 100*t/(1.4*n)},e(function(t,e){var n,r;return n=e.text(),(r=G("<div>").css({position:"relative",height:"55px"})).append(G("<div>").css({position:"absolute",bottom:0,left:0,right:0,height:a(t)+"%","background-color":"gray"})),r.append(G("<div>").text(n).css({position:"relative","padding-left":"5px","padding-right":"5px"})),e.css({padding:0,"padding-top":"5px","text-align":"center"}).html(r)})}}(this),e=n=0,a=r;0<=a?n<a:a<n;e=0<=a?++n:--n)t(".pvtVal.row"+e);return t(".pvtTotal.colTotal"),this}})}).call(this);