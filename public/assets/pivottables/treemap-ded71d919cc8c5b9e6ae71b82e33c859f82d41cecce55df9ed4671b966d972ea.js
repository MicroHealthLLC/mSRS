!function(a){var s=a.seriesTypes,r=a.merge,t=a.extendClass,i=a.getOptions().plotOptions,e=function(){},f=a.each,g=a.pick,n=a.Series,h=a.Color;i.treemap=r(i.scatter,{showInLegend:!1,marker:!1,borderColor:"#E0E0E0",borderWidth:1,dataLabels:{enabled:!0,defer:!1,verticalAlign:"middle",formatter:function(){return this.point.name||this.point.id},inside:!0},tooltip:{headerFormat:"",pointFormat:"<b>{point.name}</b>: {point.value}</b><br/>"},layoutAlgorithm:"sliceAndDice",layoutStartingDirection:"vertical",alternateStartingDirection:!1,levelIsConstant:!0,states:{hover:{borderColor:"#A0A0A0",brightness:s.heatmap?0:.1,shadow:!1}},drillUpButton:{position:{align:"left",x:10,y:-50}}}),s.treemap=t(s.scatter,r({pointAttrToOptions:{stroke:"borderColor","stroke-width":"borderWidth",fill:"color",dashstyle:"borderDashStyle"},pointArrayMap:["value"],axisTypes:s.heatmap?["xAxis","yAxis","colorAxis"]:["xAxis","yAxis"],optionalAxis:"colorAxis",getSymbol:e,parallelArrays:["x","y","value","colorValue"],colorKey:"colorValue",translateColors:s.heatmap&&s.heatmap.prototype.translateColors},{type:"treemap",trackerGroups:["group","dataLabelsGroup"],pointClass:t(a.Point,{setState:function(t,i){a.Point.prototype.setState.call(this,t,i),"hover"===t?this.dataLabel&&this.dataLabel.attr({zIndex:1002}):this.dataLabel&&this.dataLabel.attr({zIndex:this.pointAttr[""].zIndex+1})}}),handleLayout:function(){var t,i=this.tree;this.points.length&&(i||(this.nodeMap=[],i=this.tree=this.getTree()),this.rootNode||(this.rootNode=""),this.levelMap=this.getLevels(),f(this.points,function(t){delete t.plotX,delete t.plotY}),t=this.getSeriesArea(i.val),this.nodeMap[""].values=t,this.calculateArea(i,t),this.setPointValues())},getTree:function(){var t,u=this,e=0,l=[],o=[],i=function(t){f(l[t],function(t){l[""].push(t)})},v=function(i,t,e,l,o,n){var a,s,r,h,d=[],c=[],p=0;return a=o[t],r=function(){var i=0,e=!1;0!==c.length&&f(c,function(t){s.val>t.val&&!e&&(c.splice(i,0,s),e=!0),i+=1}),e||c.push(s)},a&&(h=a.name||""),void 0!==l[i]&&f(l[i],function(t){s=v(o[t].id,t,e+1,l,o,i),p+=s.val,r(),d.push(s)}),a=g(o[t]&&o[t].value,p,0),t={id:i,i:t,children:c,childrenTotal:p,val:a,level:e,parent:n,name:h},u.nodeMap[t.id]=t};for(t in f(this.points,function(t){var i="";o.push(t.id),void 0!==t.parent&&(i=t.parent),void 0===l[i]&&(l[i]=[]),l[i].push(e),e+=1}),l)l.hasOwnProperty(t)&&""!==t&&-1===HighchartsAdapter.inArray(t,o)&&(i(t),delete l[t]);return v("",-1,0,l,this.points,null)},calculateArea:function(i,e){var l,t,o,n=[],a=this,s=a.options,r=s.layoutAlgorithm,h=s.alternateStartingDirection,d=this.nodeMap[this.rootNode].level,c=0,p=s.levelIsConstant?i.level:i.level-d;i.isVisible=i.id===this.rootNode||!(!this.nodeMap[i.parent]||!this.nodeMap[i.parent].isVisible),p=0<p?p:0,this.levelMap[p+1]&&((t=this.levelMap[p+1]).layoutAlgorithm&&a[t.layoutAlgorithm]&&(r=t.layoutAlgorithm),t.layoutStartingDirection&&(e.direction="vertical"===t.layoutStartingDirection?0:1)),n=a[r](e,i.children),f(i.children,function(t){p=s.levelIsConstant?t.level:t.level-d,(o=a.points[t.i]).level=p,(l=n[c]).val=t.childrenTotal,l.direction=e.direction,h&&(l.direction=1-l.direction),t.values=l,t.isVisible=i.isVisible,o.node=t,o.value=t.val,o.isLeaf=!0,t.children.length&&(o.isLeaf=!1,a.calculateArea(t,l)),c+=1})},setPointValues:function(){var n=this,a=n.xAxis,s=n.yAxis;n.nodeMap[""].values={x:0,y:0,width:100,height:100},f(n.points,function(t){var i,e,l,o=t.node.values;o.x/=n.axisRatio,o.width/=n.axisRatio,i=Math.round(a.translate(o.x,0,0,0,1)),e=Math.round(a.translate(o.x+o.width,0,0,0,1)),l=Math.round(s.translate(o.y,0,0,0,1)),o=Math.round(s.translate(o.y+o.height,0,0,0,1)),0<t.value&&(t.shapeType="rect",t.shapeArgs={x:Math.min(i,e),y:Math.min(l,o),width:Math.abs(e-i),height:Math.abs(o-l)},t.plotX=t.shapeArgs.x+t.shapeArgs.width/2,t.plotY=t.shapeArgs.y+t.shapeArgs.height/2)})},getSeriesArea:function(t){var i="vertical"===this.options.layoutStartingDirection?0:1;return{x:0,y:0,width:100*(this.axisRatio=this.xAxis.len/this.yAxis.len),height:100,direction:i,val:t}},getLevels:function(){var i=[],t=this.options.levels;return t&&f(t,function(t){void 0!==t.level&&(i[t.level]=t)}),i},setColorRecursive:function(t,i){var e,l,o=this;t&&(e=o.points[t.i],l=o.levelMap[t.level],i=g(e&&e.options.color,l&&l.color,i),e&&(e.color=i),t.children.length&&f(t.children,function(t){o.setColorRecursive(t,i)}))},alg_func_group:function(t,i,e,l){this.height=t,this.width=i,this.plot=l,this.startDirection=this.direction=e,this.lH=this.nH=this.lW=this.nW=this.total=0,this.elArr=[],this.lP={total:0,lH:0,nH:0,lW:0,nW:0,nR:0,lR:0,aspectRatio:function(t,i){return Math.max(t/i,i/t)}},this.addElement=function(t){this.lP.total=this.elArr[this.elArr.length-1],this.total+=t,0===this.direction?(this.lW=this.nW,this.lP.lH=this.lP.total/this.lW,this.lP.lR=this.lP.aspectRatio(this.lW,this.lP.lH),this.nW=this.total/this.height,this.lP.nH=this.lP.total/this.nW,this.lP.nR=this.lP.aspectRatio(this.nW,this.lP.nH)):(this.lH=this.nH,this.lP.lW=this.lP.total/this.lH,this.lP.lR=this.lP.aspectRatio(this.lP.lW,this.lH),this.nH=this.total/this.width,this.lP.nW=this.lP.total/this.nH,this.lP.nR=this.lP.aspectRatio(this.lP.nW,this.nH)),this.elArr.push(t)},this.reset=function(){this.lW=this.nW=0,this.elArr=[],this.total=0}},alg_func_calcPoints:function(t,i,e,l){var o,n,a,s,r,h=e.lW,d=e.lH,c=e.plot,p=0,u=e.elArr.length-1;i?(h=e.nW,d=e.nH):r=e.elArr[e.elArr.length-1],f(e.elArr,function(t){(i||p<u)&&(0===e.direction?(o=c.x,n=c.y,s=t/(a=h)):(o=c.x,n=c.y,a=t/(s=d)),l.push({x:o,y:n,width:a,height:s}),0===e.direction?c.y+=s:c.x+=a),p+=1}),e.reset(),0===e.direction?e.width-=h:e.height-=d,c.y=c.parent.y+(c.parent.height-e.height),c.x=c.parent.x+(c.parent.width-e.width),t&&(e.direction=1-e.direction),i||e.addElement(r)},alg_func_lowAspectRatio:function(i,e,t){var l,o=[],n=this,a={x:e.x,y:e.y,parent:e},s=0,r=t.length-1,h=new this.alg_func_group(e.height,e.width,e.direction,a);return f(t,function(t){l=e.width*e.height*(t.val/e.val),h.addElement(l),h.lP.nR>h.lP.lR&&n.alg_func_calcPoints(i,!1,h,o,a),s===r&&n.alg_func_calcPoints(i,!0,h,o,a),s+=1}),o},alg_func_fill:function(i,e,t){var l,o,n,a,s,r=[],h=e.direction,d=e.x,c=e.y,p=e.width,u=e.height;return f(t,function(t){l=e.width*e.height*(t.val/e.val),o=d,n=c,0===h?(p-=a=l/(s=u),d+=a):(u-=s=l/(a=p),c+=s),r.push({x:o,y:n,width:a,height:s}),i&&(h=1-h)}),r},strip:function(t,i){return this.alg_func_lowAspectRatio(!1,t,i)},squarified:function(t,i){return this.alg_func_lowAspectRatio(!0,t,i)},sliceAndDice:function(t,i){return this.alg_func_fill(!0,t,i)},stripes:function(t,i){return this.alg_func_fill(!1,t,i)},translate:function(){n.prototype.translate.call(this),this.handleLayout(),this.colorAxis?this.translateColors():this.options.colorByPoint||this.setColorRecursive(this.tree,void 0)},drawDataLabels:function(){var i,e,l,o=this,t=this.dataLabelsGroup;f(o.points,function(t){t.node.isVisible&&(e=o.levelMap[t.level],!t.isLeaf||e?(i=void 0,t.isLeaf||(i={enabled:!1}),e&&(l=e.dataLabels)&&(i=r(i,l),o._hasPointLabels=!0),i=r(i,t.options.dataLabels),t.dlOptions=i):delete t.dlOptions)}),this.dataLabelsGroup=this.group,n.prototype.drawDataLabels.call(this),this.dataLabelsGroup=t},alignDataLabel:s.column.prototype.alignDataLabel,drawPoints:function(){var i,e,l,o=this,t=o.points,n=o.options;f(t,function(t){t.node.isVisible&&(l=o.levelMap[t.level],i={stroke:n.borderColor,"stroke-width":n.borderWidth,dashstyle:n.borderDashStyle,r:0,fill:g(t.color,o.color)},l&&(i.stroke=l.borderColor||i.stroke,i["stroke-width"]=l.borderWidth||i["stroke-width"],i.dashstyle=l.borderDashStyle||i.dashstyle),i.stroke=t.borderColor||i.stroke,i["stroke-width"]=t.borderWidth||i["stroke-width"],i.dashstyle=t.borderDashStyle||i.dashstyle,i.zIndex=1e3-2*t.level,t.pointAttr=r(t.pointAttr),(e=t.pointAttr.hover).zIndex=1001,e.fill=h(i.fill).brighten(n.states.hover.brightness).get(),t.isLeaf||(g(n.interactByLeaf,!n.allowDrillToNode)?(i.fill="none",delete e.fill):(i.fill=h(i.fill).setOpacity(.15).get(),e.fill=h(e.fill).setOpacity(.75).get())),t.node.level<=o.nodeMap[o.rootNode].level&&(i.fill="none",i.zIndex=0,delete e.fill),t.pointAttr[""]=a.extend(t.pointAttr[""],i),t.dataLabel&&t.dataLabel.attr({zIndex:t.pointAttr[""].zIndex+1}))}),s.column.prototype.drawPoints.call(this),f(t,function(t){t.graphic&&t.graphic.attr(t.pointAttr[""])}),n.allowDrillToNode&&o.drillTo()},drillTo:function(){var l=this;f(l.points,function(t){var i,e;t.node.isVisible&&(a.removeEvent(t,"click"),t.graphic&&t.graphic.css({cursor:"default"}),i=l.options.interactByLeaf?l.drillToByLeaf(t):l.drillToByGroup(t))&&(e=l.nodeMap[l.rootNode].name||l.rootNode,t.graphic&&t.graphic.css({cursor:"pointer"}),a.addEvent(t,"click",function(){t.setState(""),l.drillToNode(i),l.showDrillUpButton(e)}))})},drillToByGroup:function(t){var i=!1;return t.node.level-this.nodeMap[this.rootNode].level!=1||t.isLeaf||(i=t.id),i},drillToByLeaf:function(t){var i=!1;if(t.node.parent!==this.rootNode&&t.isLeaf)for(t=t.node;!i;)(t=this.nodeMap[t.parent]).parent===this.rootNode&&(i=t.id);return i},drillUp:function(){var t=null;this.rootNode&&(t=null!==(t=this.nodeMap[this.rootNode]).parent?this.nodeMap[t.parent]:this.nodeMap[""]),null!==t&&(this.drillToNode(t.id),""===t.id?this.drillUpButton=this.drillUpButton.destroy():(t=this.nodeMap[t.parent],this.showDrillUpButton(t.name||t.id)))},drillToNode:function(t){var i=this.nodeMap[t].values;this.rootNode=t,this.xAxis.setExtremes(i.x,i.x+i.width,!1),this.yAxis.setExtremes(i.y,i.y+i.height,!1),this.chart.redraw()},showDrillUpButton:function(t){var i,e,l=this,o=(t=t||"< Back",l.options.drillUpButton);o.text&&(t=o.text),this.drillUpButton?this.drillUpButton.attr({text:t}).align():(e=(i=o.theme)&&i.states,this.drillUpButton=this.chart.renderer.button(t,null,null,function(){l.drillUp()},i,e&&e.hover,e&&e.select).attr({align:o.position.align,zIndex:9}).add().align(o.position,!1,o.relativeTo||"plotBox"))},buildKDTree:e,drawLegendSymbol:a.LegendSymbolMixin.drawRectangle,getExtremes:function(){n.prototype.getExtremes.call(this,this.colorValueData),this.valueMin=this.dataMin,this.valueMax=this.dataMax,n.prototype.getExtremes.call(this)},bindAxes:function(){var t={endOnTick:!1,gridLineWidth:0,lineWidth:0,min:0,dataMin:0,minPadding:0,max:100,dataMax:100,maxPadding:0,startOnTick:!1,title:null,tickPositions:[]};n.prototype.bindAxes.call(this),a.extend(this.yAxis.options,t),a.extend(this.xAxis.options,t)}}))}(Highcharts);